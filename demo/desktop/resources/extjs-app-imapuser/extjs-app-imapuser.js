Ext.define("conjoon.cn_imapuser.overrides.coon.user.view.authentication.AuthForm",{override:"coon.user.view.authentication.AuthForm",initComponent:function(){var a=this;Ext.apply(a.items[0],{cls:"fas fa-envelope badge head-label",text:undefined,margin:"-40 0 0 0"});Ext.apply(a.items[1],{height:55,hideLabel:!0,triggers:{glyphed:{cls:"trigger-glyph-noop auth-email-trigger"}},emptyText:"email-address"});Ext.apply(a.items[2],{height:55,hideLabel:!0,triggers:{glyphed:{cls:"trigger-glyph-noop auth-password-trigger"}}});Ext.apply(a.items[3],{scale:"large",iconAlign:"right"});Ext.apply(a.items[4],{text:"Authentication failed. We recommend you check your spelling and try again."});a.items.splice(4,0,{margin:"12 0 0 0",itemId:"cn_imapuser_rememberMe",xtype:"checkbox",boxLabel:"Remember my login on this computer"});a.callParent(arguments)}});Ext.define("conjoon.cn_imapuser.overrides.coon.user.view.authentication.AuthWindow",{override:"coon.user.view.authentication.AuthWindow",header:!1,bodyCls:"x-fa cn_user-authwindow",layout:{type:"vbox",align:"stretch"},initComponent:function(){var a=this;a.items=[{xtype:"container",flex:1,layout:{type:"vbox",align:"center",pack:"center"},items:[a.items[0]]},{xtype:"box",height:80,cls:"copyrights",html:"<div class=\"cont\">"+"<div class=\"prod\">conjoon</div>"+"<div class=\"meta\">"+"<span><a target=\"_blank\" href=\"http://conjoon.org\">About</a></span>"+"<span>&#169; 2007-2021 conjoon Open Source Project</span>"+"</div>"+"</div>"}];a.callParent(arguments)}});Ext.define("conjoon.cn_imapuser.overrides.conjoon.cn_mail.data.mail.BaseSchema",{override:"conjoon.cn_mail.data.mail.BaseSchema",requires:["coon.user.Util","coon.user.Manager"],privates:{constructProxy:function(){const b=this,a=b.callParent(arguments);a.headers={Authorization:"Basic "+coon.user.Util.userToCredentials(coon.user.Manager.getUser(),coon.user.Util.BASIC_AUTH)};return a}}});Ext.define("conjoon.cn_imapuser.overrides.conjoon.cn_mail.view.mail.message.editor.MessageEditorViewController",{override:"conjoon.cn_mail.view.mail.message.editor.MessageEditorViewController",requires:["coon.user.Util","coon.user.Manager"],privates:{getSendMessageDraftRequestConfig:function(c){const b=this,a=b.callParent(arguments);a.headers={Authorization:"Basic "+coon.user.Util.userToCredentials(coon.user.Manager.getUser(),coon.user.Util.BASIC_AUTH)};return a}}});Ext.define("conjoon.cn_imapuser.UserProvider",{extend:"coon.user.DefaultUserProvider",requires:["coon.user.model.UserModel"],loadUser:function(a){const b=this;if(!Ext.isObject(a)||!Object.prototype.hasOwnProperty.call(a,"userid")||!Object.prototype.hasOwnProperty.call(a,"password")){Ext.raise({msg:"\"options\" must be an object with the properties \"userid\" and \"password\" defined",options:a})}b.isLoading=!0;Ext.Ajax.request({url:b.baseAddress?b.baseAddress+"/auth":"./rest-imapuser/auth",params:{username:a.userid,password:a.password},method:"POST",success:b.onUserLoad,failure:function(c){b.onUserLoadFailure(c,a)},scope:b})},onUserLoad:function(b){const a=this,c=Ext.decode(b.responseText);a.user=Ext.create("coon.user.model.UserModel",c.data);a.fireEvent("cn_user-userload",a,a.user);a.isLoading=!1},onUserLoadFailure:function(c,b){const a=this;a.user=null;a.fireEvent("cn_user-userloadfailure",a,b);a.isLoading=!1}});Ext.define("conjoon.cn_imapuser.app.PackageController",{extend:"coon.user.app.PackageController",requires:["coon.user.Manager","conjoon.cn_imapuser.UserProvider","Ext.util.Cookies"],control:{"cn_navport-tbar #cn_imapuser-logoutBtn":{click:"onLogoutButtonClick"}},init:function(b){const c=this,a=b.getPackageConfig(c,"service.rest-imapuser.base");coon.user.Manager.setUserProvider(Ext.create("conjoon.cn_imapuser.UserProvider",{baseAddress:a}))},preLaunchHook:function(e){const a=this,d=a.getCookies(),c=d.username,b=d.password;if(coon.user.Manager.getUser()){return !0}if(c&&b){coon.user.Manager.loadUser({params:{userid:c,password:b},success:a.onUserLoadSuccess,failure:a.onUserLoadFailure,scope:a});return !1}if(!coon.user.Manager.getUser()){this.createAuthWindow();return !1}return !0},postLaunchHook:function(){const c=this,a=c.callParent(arguments),b=coon.user.Manager.getUser();a.permaNav[0]={xtype:"button",maxWidth:200,text:b.get("username"),menu:{listeners:{beforeshow:function(a){a.setWidth(a.up("button").getWidth())}},items:[{text:"Logout",itemId:"cn_imapuser-logoutBtn"}]}};return a},userAvailable:function(b){const a=this;if(a.authWindow){if(a.authWindow.down("#cn_imapuser_rememberMe").getValue()){this.setCookies(b.get("username"),b.get("password"))}else {this.setCookies(null)}}return a.callParent(arguments)},userWasNotAuthorized:function(){const b=this,a=b.authWindow;if(!a){return}a.down("cn_user-authform").showAuthorizationFailed(!0)},privates:{onUserLoadFailure:function(c){const a=this,b=a.authWindow;this.setCookies(null);if(!b){this.createAuthWindow()}return a.callParent(arguments)},onLogoutButtonClick:function(a){this.setCookies(null);window.location.reload()},setCookies:function(a,b){if(arguments.length===1&&a===null){Ext.util.Cookies.clear("cn_imapuser-username","./");Ext.util.Cookies.clear("cn_imapuser-password","./");return null}let c=new Date(Date.now()+((60*60*24)*1000));Ext.util.Cookies.set("cn_imapuser-username",a,c,"./");Ext.util.Cookies.set("cn_imapuser-password",b,c,"./");return {username:a,password:b}},getCookies:function(){return {username:Ext.util.Cookies.get("cn_imapuser-username"),password:Ext.util.Cookies.get("cn_imapuser-password")}}}});