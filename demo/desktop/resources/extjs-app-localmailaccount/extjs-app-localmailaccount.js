function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(b){return typeof b}:function(b){return b&&"function"==typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},_typeof(a)}function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_unsupportedIterableToArray(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,c){if(!a){return}if(typeof a==="string"){return _arrayLikeToArray(a,c)}var b=Object.prototype.toString.call(a).slice(8,-1);if(b==="Object"&&a.constructor){b=a.constructor.name}if(b==="Map"||b==="Set"){return Array.from(a)}if(b==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(b)){return _arrayLikeToArray(a,c)}}function _arrayLikeToArray(c,a){if(a==null||a>c.length){a=c.length}for(var b=0,d=new Array(a);b<a;b++){d[b]=c[b]}return d}function _iterableToArrayLimit(b,j){var a=null==b?null:"undefined"!=typeof Symbol&&b[Symbol.iterator]||b["@@iterator"];if(null!=a){var h,g,i,e,d=[],c=!0,f=!1;try{if(i=(a=a.call(b)).next,0===j){if(Object(a)!==a){return}c=!1}else {for(;!(c=(h=i.call(a)).done)&&(d.push(h.value),d.length!==j);c=!0){}}}catch(k){f=!0,g=k}finally{try{if(!c&&null!=a["return"]&&(e=a["return"](),Object(e)!==e)){return}}finally{if(f){throw g}}}return d}}function _arrayWithHoles(a){if(Array.isArray(a)){return a}}function ownKeys(b,d){var c=Object.keys(b);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(b);d&&(a=a.filter(function(a){return Object.getOwnPropertyDescriptor(b,a).enumerable})),c.push.apply(c,a)}return c}function _objectSpread(c){for(var b=1;b<arguments.length;b++){var a=null!=arguments[b]?arguments[b]:{};b%2?ownKeys(Object(a),!0).forEach(function(b){_defineProperty(c,b,a[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach(function(b){Object.defineProperty(c,b,Object.getOwnPropertyDescriptor(a,b))})}return c}function _defineProperty(b,a,c){a=_toPropertyKey(a);if(a in b){Object.defineProperty(b,a,{value:c,enumerable:!0,configurable:!0,writable:!0})}else {b[a]=c}return b}function _toPropertyKey(b){var a=_toPrimitive(b,"string");return _typeof(a)==="symbol"?a:String(a)}function _toPrimitive(a,b){if(_typeof(a)!=="object"||a===null){return a}var c=a[Symbol.toPrimitive];if(c!==undefined){var d=c.call(a,b||"default");if(_typeof(d)!=="object"){return d}throw new TypeError("@@toPrimitive must return a primitive value.")}return (b==="string"?String:Number)(a)}Ext.define("conjoon.localmailaccount.data.MailAccountRepository",{requires:["l8"],idPrefix:"cn_localmailaccount",idPostfixTemplate:"-\\d",insert:function insert(a){var b=this,c=b.nextId();a.id=c;b.getStorage().setItem(c,b.encodeItem(a));return Object.assign({},a)},update:function update(b,f){var a=this,d=a.query(b);if(!d){return undefined}var e=a.decodeItem(f);var c=Object.assign(d,e);a.getStorage().setItem(b,a.encodeItem(c));return Object.assign({},_objectSpread({id:b},c))},nextId:function nextId(){var a=this,b=a.idPrefix,d=a.idPostfixTemplate,e=a.queryAll(),c=e.map(function(a){return a.id}).filter(function(a){return a!==undefined});return c.length===0?b+"-1":l8.text.nameToOrdinal(b,c,d)},queryAll:function queryAll(){var b=this,f=b.idPrefix,a=b.getStorage(),e=[];for(var c=0,g=a.length;c<g;c++){var d=a.key(c);if(d.indexOf(f)!==0){continue}e.push(b.decodeItem(a.getItem(d)))}return e},query:function query(a){var b=this,c=b.idPrefix,e=b.getStorage();if(a.indexOf(c)!==0){throw new Error("Unexpected id: ".concat(a,", expected id to contain \"").concat(c,"\""))}var d=e.getItem(a);if(d){return b.decodeItem(d)}return undefined},decodeItem:function decodeItem(a){if(l8.isString(a)){try{a=JSON.parse(a)}catch(b){throw new Error("Could not decode MailAccount saved in LocalStorage. "+"Please clear the LocalStorage if this problem persists.")}}["replyTo","from"].map(function(b){if(a[b]===undefined){return}try{a[b]=JSON.parse(a[b])}catch(c){a[b]={}}});return a},encodeItem:function encodeItem(b){var a=Object.fromEntries(Object.entries(b).map(function(e){var c=_slicedToArray(e,2),d=c[0],a=c[1];if(["from","replyTo"].includes(d)){if(l8.isObject(a)){a=JSON.stringify(a)}}return [d,a]}));return JSON.stringify(a)},getStorage:function getStorage(){return window.localStorage}});Ext.define("conjoon.localmailaccount.data.MailAccountToLocalStorageSim",{extend:"Ext.ux.ajax.JsonSimlet",requires:["conjoon.localmailaccount.data.MailAccountRepository"],statics:{required:{mailAccountRepository:"conjoon.localmailaccount.data.MailAccountRepository"}},doGet:function doGet(d){var b=this,c=b.mailAccountRepository.queryAll(),a={};a.status=200;a.responseText=JSON.stringify({data:c});Ext.Array.forEach(b.responseProps,function(c){if(c in b){a[c]=b[c]}});return a},doPost:function doPost(d){var e=this,c=JSON.parse(d.xhr.body),b=e.mailAccountRepository.insert(c),a={};a.status=200;a.responseText=JSON.stringify({data:{id:b.id}});return a},doPatch:function doPatch(c){var f=this,d=JSON.parse(c.xhr.body),e=c.xhr.url.split("/").pop().split("?").shift(),a=f.mailAccountRepository.update(e,d),b={};b.status=a?200:400;if(a){b.responseText=JSON.stringify({data:a})}return b}});Ext.define("conjoon.localmailaccount.app.PackageController",{extend:"coon.core.app.PackageController",requires:["l8","conjoon.localmailaccount.data.MailAccountToLocalStorageSim","Ext.ux.ajax.SimManager"],init:function init(b){var c=this,a=b.getPackageConfig(c);Ext.ux.ajax.SimManager.defaultSimlet=null;Ext.ux.ajax.SimManager.register(Ext.create("conjoon.localmailaccount.data.MailAccountToLocalStorageSim",{url:new RegExp(a.interceptUri,"im"),delay:1}))},preLaunchHook:function preLaunchHook(c){var b=this;var a=c.getPackageConfig(b,"title");a&&Ext.fireEvent("conjoon.application.TitleAvailable",b,a);return !0}});function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(b){return typeof b}:function(b){return b&&"function"==typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},_typeof(a)}function _wrapRegExp(){_wrapRegExp=function _wrapRegExp(b,a){return new BabelRegExp(b,void 0,a)};var b=RegExp.prototype,a=new WeakMap();function BabelRegExp(c,e,d){var b=new RegExp(c,e);return a.set(b,d||a.get(c)),_setPrototypeOf(b,BabelRegExp.prototype)}function buildGroups(b,d){var c=a.get(d);return Object.keys(c).reduce(function(f,g){var a=c[g];if("number"==typeof a){f[g]=b[a]}else {for(var e=0;void 0===b[a[e]]&&e+1<a.length;){e++}f[g]=b[a[e]]}return f},Object.create(null))}return _inherits(BabelRegExp,RegExp),BabelRegExp.prototype.exec=function(d){var a=b.exec.call(this,d);if(a){a.groups=buildGroups(a,this);var c=a.indices;c&&(c.groups=buildGroups(c,this))}return a},BabelRegExp.prototype[Symbol.replace]=function(d,c){if("string"==typeof c){var e=a.get(this);return b[Symbol.replace].call(this,d,c.replace(/\$<([^>]+)>/g,function(f,b){var a=e[b];return "$"+(Array.isArray(a)?a.join("$"):a)}))}if("function"==typeof c){var f=this;return b[Symbol.replace].call(this,d,function(){var a=arguments;return "object"!=_typeof(a[a.length-1])&&(a=[].slice.call(a)).push(buildGroups(a,f)),c.apply(this,a)})}return b[Symbol.replace].call(this,d,c)},_wrapRegExp.apply(this,arguments)}function _inherits(b,a){if(typeof a!=="function"&&a!==null){throw new TypeError("Super expression must either be null or a function")}b.prototype=Object.create(a&&a.prototype,{constructor:{value:b,writable:!0,configurable:!0}});Object.defineProperty(b,"prototype",{writable:!1});if(a){_setPrototypeOf(b,a)}}function _setPrototypeOf(a,b){_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(c,d){c.__proto__=d;return c};return _setPrototypeOf(a,b)}Ext.define("conjoon.localmailaccount.data.request.Configurator",{extend:"coon.core.data.request.Configurator",requires:["l8","Ext.data.Request","conjoon.cn_mail.data.mail.service.MailFolderHelper"],configure:function configure(a){var c=this,d=a instanceof Ext.data.Request,e=d?a.getUrl():a.url;if(!c.needsAuth(e)){return a}var b=c.getAccountForUrl(e);if(!b){throw new Error("no MailAccount found for url ".concat(e))}var f={from:b.get("from"),replyTo:b.get("replyTo")};var h=c.isInboxRequest(a),j=b.getInboxAuth(),i=h?Object.assign(b.getInboxInfo(),f):Object.assign(b.getOutboxInfo(!0),b.getInboxInfo(),f),k=(d?a.getHeaders():a.headers)||{},g=Object.assign(k,{Authorization:"Basic "+c.encode(j.join(":")),"X-CNMAIL-DATA":c.encode(i)});if(d){a.setHeaders(g)}else {a.headers=g}return a},getAccountForUrl:function getAccountForUrl(c){var d=this;var b=d.parse(c);if(!b){throw new Error("Could not determine mailAccountId for url ".concat(c))}var e=d.getMailFolderHelper();var a=e.getAccountNode(b);return a!==null&&a!==void 0?a:undefined},getMailFolderHelper:function getMailFolderHelper(){return conjoon.cn_mail.data.mail.service.MailFolderHelper.getInstance()},needsAuth:function needsAuth(a){var b=this;return !!b.parse(a)},parse:function parse(d){var c=_wrapRegExp(/MailAccounts\/(.*)\/MailFolders/im,{mailAccountId:1}),a=c.exec(d);var b;if(a&&a.groups.mailAccountId){b=decodeURIComponent(a.groups.mailAccountId)}return b},isInboxRequest:function isInboxRequest(a){var b=a instanceof Ext.data.Request;var c=b?a.getMethod():a.method;var f=b?a.getUrl():a.url;var d=/MailAccounts\/(.*)\/MailFolders\/(.*)\/MessageItems\/(.*)/im,e=d.exec(f);if(e&&c.toLowerCase()==="post"){return !1}return !0},encode:function encode(a){return l8.isString(a)?btoa(a):btoa(JSON.stringify(a))}});Ext.define("conjoon.localmailaccount.dev.BasicAuthSimletAdapter",{extend:"conjoon.dev.cn_mailsim.data.SimletAdapter",validateMailAccountId:function validateMailAccountId(a){return !0},validateRequest:function validateRequest(b){var c=this,a=b.requestHeaders,d=a?a.Authorization:null,f=a?a["X-CNMAIL-DATA"]:null;if(!d){return c.make401(b)}var e=d.split(" ");if(e[0]!=="Basic"||!e[1]){return c.make401(b)}if(!f){return c.make400(b)}return null},make400:function make400(a){console.log(" --- Bad Request ",400,a);return {status:400,success:!1}},make401:function make401(a){console.log(" --- Auth failed ",401,a);return {status:401,success:!1}},make403:function make403(a){console.log(" --- Auth failed ",403,a);return {status:401,success:!1}}});