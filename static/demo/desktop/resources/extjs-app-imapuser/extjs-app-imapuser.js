Ext.define("conjoon.cn_imapuser.overrides.coon.user.view.authentication.AuthForm",{override:"coon.user.view.authentication.AuthForm",initComponent:function initComponent(){var a=this;Ext.apply(a.items[0],{cls:"fas fa-envelope badge head-label",text:undefined,margin:"-40 0 0 0"});Ext.apply(a.items[1],{height:55,hideLabel:!0,triggers:{glyphed:{cls:"trigger-glyph-noop auth-email-trigger"}},emptyText:"email-address"});Ext.apply(a.items[2],{height:55,hideLabel:!0,triggers:{glyphed:{cls:"trigger-glyph-noop auth-password-trigger"}}});Ext.apply(a.items[3],{scale:"large",iconAlign:"right"});Ext.apply(a.items[4],{text:"Authentication failed. We recommend you check your spelling and try again."});a.items.splice(4,0,{margin:"12 0 0 0",itemId:"cn_imapuser_rememberMe",xtype:"checkbox",boxLabel:"Remember my login on this computer"});a.callParent(arguments)}});Ext.define("conjoon.cn_imapuser.overrides.coon.user.view.authentication.AuthWindow",{override:"coon.user.view.authentication.AuthWindow",header:!1,bodyCls:"x-fa cn_user-authwindow",layout:{type:"vbox",align:"stretch"},initComponent:function initComponent(){var a=this;a.items=[{xtype:"container",flex:1,layout:{type:"vbox",align:"center",pack:"center"},items:[a.items[0]]},{xtype:"box",height:80,cls:"copyrights",html:"<div class=\"cont\">"+"<div class=\"prod\">conjoon</div>"+"<div class=\"meta\">"+"<span><a target=\"_blank\" href=\"http://conjoon.org\">About</a></span>"+"<span>&#169; 2007-2022 conjoon Open Source Project</span>"+"</div>"+"</div>"}];a.callParent(arguments)}});Ext.define("conjoon.cn_imapuser.UserProvider",{extend:"coon.user.DefaultUserProvider",requires:["l8","coon.user.model.UserModel"],loadUser:function loadUser(a){var b=this;if(!Ext.isObject(a)||!Object.prototype.hasOwnProperty.call(a,"userid")||!Object.prototype.hasOwnProperty.call(a,"password")){Ext.raise({msg:"\"options\" must be an object with the properties \"userid\" and \"password\" defined",options:a})}b.isLoading=!0;Ext.Ajax.request({url:l8.unify(b.baseAddress?b.baseAddress+"/auth":"./rest-imapuser/auth","/","://"),params:{username:a.userid,password:a.password},method:"POST",success:b.onUserLoad,failure:function failure(c){b.onUserLoadFailure(c,a)},scope:b})},onUserLoad:function onUserLoad(b){var a=this,c=Ext.decode(b.responseText);a.user=Ext.create("coon.user.model.UserModel",c.data);a.fireEvent("cn_user-userload",a,a.user);a.isLoading=!1},onUserLoadFailure:function onUserLoadFailure(c,b){var a=this;a.user=null;a.fireEvent("cn_user-userloadfailure",a,b);a.isLoading=!1}});Ext.define("conjoon.cn_imapuser.app.PackageController",{extend:"coon.user.app.PackageController",requires:["l8","coon.user.Manager","conjoon.cn_imapuser.UserProvider","Ext.util.Cookies","coon.core.ServiceLocator"],control:{"cn_navport-tbar #cn_imapuser-logoutBtn":{click:"onLogoutButtonClick"}},init:function init(c){var b=this,a=c.getPackageConfig(b,"service.rest-imapuser.base");b.userImageService=coon.core.ServiceLocator.resolve("coon.core.service.UserImageService");coon.user.Manager.setUserProvider(Ext.create("conjoon.cn_imapuser.UserProvider",{baseAddress:a?l8.unify(a,"/","://"):undefined}))},preLaunchHook:function preLaunchHook(f){var a=this,d=a.getCookies(),c=d.username,b=d.password;if(coon.user.Manager.getUser()){return !0}var e=f.getPackageConfig(a,"title");e&&Ext.fireEvent("conjoon.application.TitleAvailable",a,e);if(c&&b){coon.user.Manager.loadUser({params:{userid:c,password:b},success:a.onUserLoadSuccess,failure:a.onUserLoadFailure,scope:a});return !1}if(!coon.user.Manager.getUser()){this.createAuthWindow();return !1}return !0},postLaunchHook:function postLaunchHook(){var c=this,a=c.callParent(arguments),b=coon.user.Manager.getUser();a.permaNav.items[0]={xtype:"button",maxWidth:200,text:b.get("username"),menu:{listeners:{beforeshow:function beforeshow(a){a.setWidth(a.up("button").getWidth())}},items:[{text:"Logout",itemId:"cn_imapuser-logoutBtn"}]}};a.permaNav.items[1]={xtype:"cn_user-toolbaruserimageitem",src:c.userImageService.getImageSrc(b.get("username"))};return a},userAvailable:function userAvailable(b){var a=this;if(a.authWindow){if(a.authWindow.down("#cn_imapuser_rememberMe").getValue()){this.setCookies(b.get("username"),b.get("password"))}else {this.setCookies(null)}}return a.callParent(arguments)},userWasNotAuthorized:function userWasNotAuthorized(){var b=this,a=b.authWindow;if(!a){return}a.down("cn_user-authform").showAuthorizationFailed(!0)},privates:{onUserLoadFailure:function onUserLoadFailure(c){var a=this,b=a.authWindow;this.setCookies(null);if(!b){this.createAuthWindow()}return a.callParent(arguments)},onLogoutButtonClick:function onLogoutButtonClick(a){this.setCookies(null);window.location.reload()},setCookies:function setCookies(a,b){if(arguments.length===1&&a===null){Ext.util.Cookies.clear("cn_imapuser-username","./");Ext.util.Cookies.clear("cn_imapuser-password","./");return null}var c=new Date(Date.now()+60*60*24*1000);Ext.util.Cookies.set("cn_imapuser-username",a,c,"./");Ext.util.Cookies.set("cn_imapuser-password",b,c,"./");return {username:a,password:b}},getCookies:function getCookies(){return {username:Ext.util.Cookies.get("cn_imapuser-username"),password:Ext.util.Cookies.get("cn_imapuser-password")}}}});Ext.define("conjoon.cn_imapuser.data.request.Configurator",{extend:"coon.core.data.request.Configurator",requires:["l8","coon.user.Util","coon.user.Manager","Ext.data.Request"],configure:function configure(a){var b=a instanceof Ext.data.Request,d=(b?a.getHeaders():a.headers)||{},c=Object.assign(d,{Authorization:"Basic "+coon.user.Util.userToCredentials(coon.user.Manager.getUser(),coon.user.Util.BASIC_AUTH)});if(b){a.setHeaders(c)}else {a.headers=c}return a}});Ext.define("conjoon.cn_imapuser.dev.BasicAuthSimletAdapter",{extend:"conjoon.dev.cn_mailsim.data.SimletAdapter",validateMailAccountId:function validateMailAccountId(a){return !0},validateRequest:function validateRequest(a){var e=this,c=a.requestHeaders,b=c?c.Authorization:null;if(!b){return e.make401(a)}var d=b.split(" ");if(d[0]!=="Basic"||!d[1]){return e.make401(a)}return null},make400:function make400(a){console.log(" --- Bad Request ",400,a);return {status:400,success:!1}},make401:function make401(a){console.log(" --- Auth failed ",401,a);return {status:401,success:!1}},make403:function make403(a){console.log(" --- Auth failed ",403,a);return {status:401,success:!1}}});